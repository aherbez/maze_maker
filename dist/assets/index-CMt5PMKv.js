(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const l of document.querySelectorAll('link[rel="modulepreload"]'))s(l);new MutationObserver(l=>{for(const i of l)if(i.type==="childList")for(const o of i.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&s(o)}).observe(document,{childList:!0,subtree:!0});function e(l){const i={};return l.integrity&&(i.integrity=l.integrity),l.referrerPolicy&&(i.referrerPolicy=l.referrerPolicy),l.crossOrigin==="use-credentials"?i.credentials="include":l.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function s(l){if(l.ep)return;l.ep=!0;const i=e(l);fetch(l.href,i)}})();function M(n,t,e){const s=document.getElementById(n);s.width=t,s.height=e;const l=s.getContext("2d");return{canvas:s,ctx:l}}const a={canvasWidth:700,canvasHeight:700,margin:20,wallThickness:4,wallColor:"#000000",mazeColor:"#FFFFFF",playerColor:"#FF0000",backgroundColor:"#00C0CC"},H=0,u=1,m=2,E=3,C={MazeDataUpdated:"mazeDataUpdated",MazeSizeUpdated:"mazeSizeUpdated"};class S{constructor(t,e,s,l){this.x=t,this.y=e,this.cellWidth=s,this.cellHeight=l,this.exits=[!1,!1,!1,!1]}draw(t){t.save(),t.strokeStyle=a.wallColor,t.lineWidth=a.wallThickness,t.beginPath(),this.exits.forEach((e,s)=>{if(!e)switch(s){case u:t.moveTo(this.cellWidth,-a.wallThickness/2),t.lineTo(this.cellWidth,this.cellHeight+a.wallThickness/2);break;case m:t.moveTo(-a.wallThickness/2,this.cellHeight),t.lineTo(this.cellWidth+a.wallThickness/2,this.cellHeight);break}}),t.stroke(),t.restore()}}class L{constructor(t){this.initFromData(t)}initCells(){this.cells=[];for(let t=0;t<this.cellsY;t++){const e=[];for(let s=0;s<this.cellsX;s++){const l=new S(s,t,this.cellWidth,this.cellHeight);e.push(l)}this.cells.push(e)}}setSize(t,e){this.cellsX=t,this.cellsY=e,this.cellWidth=(a.canvasWidth-a.margin*2)/this.cellsX,this.cellHeight=(a.canvasHeight-a.margin*2)/this.cellsY,this.start={x:0,y:0,dir:E},this.exit={x:this.cellsX-1,y:this.cellsY-1,dir:u},this.initCells()}initFromData(t){this.cellsX=t.cells[0].length,this.cellsY=t.cells.length,this.cellWidth=(a.canvasWidth-a.margin*2)/this.cellsX,this.cellHeight=(a.canvasHeight-a.margin*2)/this.cellsY,this.initCells();for(let e=0;e<this.cellsY;e++)for(let s=0;s<this.cellsX;s++){const l=(t.cells[e][s]&1)>0,i=(t.cells[e][s]&2)>0;l||this.carvePath(s,e,u),i||this.carvePath(s,e,m)}this.start={x:t.start[0],y:t.start[1],dir:t.start[2]},this.exit={x:t.exit[0],y:t.exit[1],dir:t.exit[2]},this.carvePath(this.start.x,this.start.y,this.start.dir),this.carvePath(this.exit.x,this.exit.y,this.exit.dir)}get startLocation(){return[this.start.x,this.start.y]}get exitLocation(){return[this.exit.x,this.exit.y]}get mazeData(){const t={};return t.start=[this.start.x,this.start.y,this.start.dir],t.exit=[this.exit.x,this.exit.y,this.exit.dir],t.cells=this.cells.map(e=>e.map(s=>{let l=0;return s.exits[u]||(l|=1),s.exits[m]||(l|=2),l})),t}getCell(t,e){return t<0||t>=this.cellsX||e<0||e>=this.cellsY?null:this.cells[e][t]}getNeighbor(t,e){switch(e){case u:return this.getCell(t.x+1,t.y);case m:return this.getCell(t.x,t.y+1);case E:return this.getCell(t.x-1,t.y);case H:return this.getCell(t.x,t.y-1);default:return null}}carvePath(t,e,s){const l=this.getCell(t,e);if(!l)return;l.exits[s]=!0;const i=(s+2)%4,o=this.getNeighbor(l,s);o&&(o.exits[i]=!0)}addWall(t,e,s){const l=this.getCell(t,e);if(!l)return;l.exits[s]=!1;const i=(s+2)%4,o=this.getNeighbor(l,s);o&&(o.exits[i]=!1)}toggleWall(t,e,s){const l=this.getCell(t,e);if(!l)return;!l.exits[s]?this.carvePath(t,e,s):this.addWall(t,e,s);const o=new CustomEvent(C.MazeDataUpdated,{detail:{mazeData:this.mazeData}});window.dispatchEvent(o)}handleWallClick(t,e){const s=t-(this.cellWidth-20),l=e-(this.cellHeight-20);let i=Math.floor(s/this.cellWidth),o=Math.floor(l/this.cellHeight);const r=Math.abs(s-i*this.cellWidth),h=Math.abs(l-o*this.cellHeight);r<40&&h<40?console.log("Clicked on a corner, ambiguous intent"):r>40&&h>40?console.log("Clicked inside cell, not on a wall"):r<h?(o=Math.floor((e-a.margin)/this.cellHeight),this.toggleWall(i,o,u)):(i=Math.floor((t-a.margin)/this.cellWidth),this.toggleWall(i,o,m))}drawExit(t,e,s,l){t.save(),t.fillStyle=a.mazeColor,t.translate((e+.5)*this.cellWidth,(s+.5)*this.cellHeight),t.beginPath(),t.moveTo(0,0),t.rotate(l*(Math.PI/2)),t.rect(-this.cellWidth/2+a.wallThickness/2,-this.cellHeight/2-a.wallThickness/2-2,this.cellWidth-a.wallThickness,a.wallThickness+4),t.fill(),t.restore()}drawGrid(t){t.save(),t.strokeStyle=a.gridColor,t.lineWidth=1;for(let e=0;e<=this.cellsX;e++)t.beginPath(),t.moveTo(e*this.cellWidth,0),t.lineTo(e*this.cellWidth,this.cellsY*this.cellHeight),t.stroke();for(let e=0;e<=this.cellsY;e++)t.beginPath(),t.moveTo(0,e*this.cellHeight),t.lineTo(this.cellsX*this.cellWidth,e*this.cellHeight),t.stroke();t.restore()}draw(t){t.save(),t.fillStyle=a.mazeColor,t.strokeStyle=a.wallColor,t.lineWidth=a.wallThickness,t.beginPath(),t.rect(0,0,this.cellWidth*this.cellsX,this.cellHeight*this.cellsY),t.fill(),t.stroke(),t.restore(),this.drawGrid(t),t.save();for(let e=0;e<this.cellsY;e++)for(let s=0;s<this.cellsX;s++){t.save();const l=this.cells[e][s];t.translate(s*this.cellWidth,e*this.cellHeight),l.draw(t),t.restore()}this.drawExit(t,this.exit.x,this.exit.y,this.exit.dir),this.drawExit(t,this.start.x,this.start.y,this.start.dir),t.restore()}}class P{constructor(t,e={}){this.element=document.getElementById(t),this.element.style.border="1px solid black",this.element.style.padding="10px";const s=document.createElement("h2");s.textContent="Settings",this.element.appendChild(s),this.cellsX=e.cellsX||10,this.cellsY=e.cellsY||10,this.addNumberInput("Cells X",this.cellsX,l=>{this.cellsX=l}),this.addNumberInput("Cells Y",this.cellsY,l=>{this.cellsY=l}),this.addButton("Update Size",()=>{const l=new CustomEvent(C.MazeSizeUpdated,{detail:{cellsX:this.cellsX,cellsY:this.cellsY}});window.dispatchEvent(l)})}addButton(t,e){const s=document.createElement("button");s.textContent=t,s.style.display="block",s.style.marginTop="10px",s.addEventListener("click",e),this.element.appendChild(s)}addNumberInput(t,e,s){const l=document.createElement("label");l.textContent=t,l.style.display="block",l.style.marginBottom="5px";const i=document.createElement("input");i.type="number",i.value=e,i.style.width="100%",i.style.padding="5px",i.style.boxSizing="border-box",i.addEventListener("change",()=>{const o=parseInt(i.value,10);isNaN(o)||s(o)}),l.appendChild(i),this.element.appendChild(l)}}const B=n=>{const t=[];t.push(n.cells[0].length),t.push(n.cells.length),t.push(n.start[0]),t.push(n.start[1]),t.push(n.exit[0]),t.push(n.exit[1]);const e=[];let s=0,l=0;const i=r=>{const h=r&3;l|=h<<s,s+=2,s>=8&&(e.push(l),l=0,s=0)};i(n.start[2]),i(n.exit[2]);for(let r=0;r<n.cells.length;r++)for(let h=0;h<n.cells[r].length;h++)i(n.cells[r][h]);s>0&&e.push(l),t.push(...e);const o=String.fromCharCode(...t);return btoa(o).replace(/\+/g,"-").replace(/\//g,"_")},N=n=>{const t=n.replace(/-/g,"+").replace(/_/g,"/"),e=atob(t),s=new Uint8Array(e.length);for(let c=0;c<e.length;c++)s[c]=e.charCodeAt(c);const l={},i=Array.from(s.slice(0,6)),o=i[0],r=i[1],h=[i[2],i[3]],Y=[i[4],i[5]],T=o*r+2,X=6;let k=0,p=0,z=X;const g=[];for(let c=0;c<T;c++){p===0&&(k=s[z++]);const y=k>>p&3;g.push(y),p+=2,p>=8&&(p=0)}l.start=[...h,g[0]],l.exit=[...Y,g[1]];const W=[];for(let c=0;c<r;c++){const y=[];for(let v=0;v<o;v++){const x=c*o+v+2;if(x>=g.length)throw new Error("Not enough two-bit values to unpack cells");y.push(g[x])}W.push(y)}return l.cells=W,l};class U{constructor(t){this.element=document.getElementById(t),this.addLabel("Maze Data (Compressed)"),this.outputCompressed=document.createElement("pre"),this.outputCompressed.style.border="1px solid black",this.outputCompressed.style.padding="10px",this.outputCompressed.style.backgroundColor="#f0f0f0",this.element.appendChild(this.outputCompressed),this.addLabel("Maze Data (JSON)"),this.outputJson=document.createElement("pre"),this.outputJson.style.border="1px solid black",this.outputJson.style.maxHeight="80vh",this.outputJson.style.overflowY="auto",this.outputJson.style.padding="10px",this.outputJson.style.backgroundColor="#f0f0f0",this.element.appendChild(this.outputJson)}addLabel(t){const e=document.createElement("h2");e.textContent=t,this.element.appendChild(e)}updateMazeData(t){this.outputJson.textContent=JSON.stringify(t,null,2),this.outputCompressed.textContent=B(t)}}const{canvas:w,ctx:f}=M("mazeCanvas",a.canvasWidth,a.canvasHeight),F={start:[2,2,2],exit:[2,0,1],cells:[[0,2,2],[1,0,1],[2,3,1]]};let d=null,b=null;const O=()=>{let n=F,e=new URLSearchParams(window.location.search).get("data");if(e)try{const l=N(e);console.log("Unpacked data from URL:",l),n=l}catch(l){console.warn("Failed to unpack data from URL:",l)}d=new L(n,a),new P("inputContainer",{cellsX:d.cellsX,cellsY:d.cellsY}),b=new U("outputContainer"),b.updateMazeData(d.mazeData),I();const s=()=>{f.clearRect(0,0,w.width,w.height),f.save(),f.translate(a.margin,a.margin),d.draw(f),f.restore(),requestAnimationFrame(s)};s()},I=()=>{window.addEventListener(C.MazeDataUpdated,n=>{console.log("Maze data updated:",n.detail.mazeData),b.updateMazeData(n.detail.mazeData)}),window.addEventListener(C.MazeSizeUpdated,n=>{console.log("Maze size updated:",n.detail),d.setSize(n.detail.cellsX,n.detail.cellsY),b.updateMazeData(d.mazeData)}),w.addEventListener("click",n=>{const t=w.getBoundingClientRect(),e=n.clientX-t.left,s=n.clientY-t.top;console.log(`Canvas clicked at: (${e}, ${s})`);let l=e-a.margin,i=s-a.margin;d.handleWallClick(l,i)})};O();
